<ion-header [translucent]="true">


  <ion-toolbar class = "profile-nav" >

      <ion-tabs>
        <ion-tab-bar slot="end">
          <ion-tab-button tab="profile" routerLink="/profile" routerDirection="root">
            <ion-icon name="person-circle-outline"></ion-icon>
            <ion-label>Profile</ion-label>
          </ion-tab-button>
    
          <ion-tab-button tab="create-listing" routerLink="/create-listing" routerDirection="root" >
            <ion-icon name="add-circle-outline"></ion-icon>
            <ion-label>Create Listing</ion-label>
          </ion-tab-button>
    
          <ion-tab-button tab="saved-listings" routerLink="/saved-listings" routerDirection="root">
            <ion-icon name="heart-outline"></ion-icon>
            <ion-label>Saved Listings</ion-label>
          </ion-tab-button>
    
          <ion-tab-button tab="my-listings" routerLink="/my-listings" routerDirection="root" class="green-tab">
            <ion-icon name="list-outline"></ion-icon>
            <ion-label>My Listings</ion-label>
          </ion-tab-button>
        </ion-tab-bar>
      </ion-tabs>

  </ion-toolbar>
</ion-header>

<ion-content>

  <section id="category">
    <ion-grid>
      <ion-row>
        <ion-col style="display: flex; justify-content: center" class="rightBorder">
          <ion-label>Buy</ion-label>
        </ion-col>
        <ion-col style="display: flex; justify-content: center">
          <ion-label>Rent</ion-label>
        </ion-col>
      </ion-row>
    </ion-grid>
  </section>

  <ng-container *ngIf="loading; else loaded">
    <div id="loader">
      <h2>{{loadingMessage}}</h2>
      <br>
      <img src="assets/500.gif">
    </div>
  </ng-container>
  <ng-template #loaded>
    <section id="first">
      <ion-grid>
        <ion-row>
          <ion-col class="rightBorder" size="6">
            <ion-card class="listingCard" *ngFor="let listing of savedListingsB" >
              <ion-grid>
                <ion-row>
                  <ion-col size="4" class="imageCol">
                    <img src="{{listing.photos[0]}}" onerror="this.src='assets/no-propertyfound.png'" alt="house1">
                  </ion-col>
                  <ion-col size="8" (click)="redirectToPage(listing)">
                    <ion-grid>
                      <ion-row>
                        <ion-col>
                          <ion-card-title style="color: #0DAE4F;">R {{formatNumber(listing.price)}}</ion-card-title>
                        </ion-col>
                        <ion-col>
                          <div class="statusBadge {{listing.status}}">{{listing.status}}</div>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                    <p><b>{{listing.address}}</b></p>
                    <p style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap">
                      {{listing.bed}} Bedroom {{listing.prop_type === "Commercial"? listing.prop_type + " Property" : listing.prop_type}}
                    </p>
                    <p>For Sale!</p>
                    <p id="house_description">
                    {{listing.desc}}
                    </p>
                    <div id="house_details">
                      <img src="assets/icon/bedrooms.png">
                      {{listing.bed}}
                      &nbsp; &nbsp;&nbsp;
                      <img src="assets/icon/bathrooms.png">
                      {{listing.bath}}
                      &nbsp; &nbsp;&nbsp;
                      <img src="assets/icon/floorplan.png">
                      {{listing.floor_size}} m<sup>2</sup>
                      &nbsp; &nbsp;&nbsp;
                      <img src="assets/icon/erf.png">
                      {{listing.property_size}} m<sup>2</sup>
                    </div>
                  </ion-col>
                </ion-row>
              </ion-grid>
          </ion-card>
          <ng-container *ngIf="!savedListingsB.length">
            <div style="width: 100%; display: flex; justify-content: center;">
              <ion-icon name="home-outline"></ion-icon>
              <div>No saved listings to show</div>
            </div>
          </ng-container>
          </ion-col>
            <ion-col class="rightBorder" size="6">
              <ion-card class="listingCard" *ngFor="let listing of savedListingsR" >
                <ion-grid>
                  <ion-row>
                    <ion-col size="4" class="imageCol">
                      <img src="{{listing.photos[0]}}" onerror="this.src='assets/no-propertyfound.png'" alt="house1">
                    </ion-col>
                    <ion-col size="8" (click)="redirectToPage(listing)">
                      <ion-grid>
                        <ion-row>
                          <ion-col>
                            <ion-card-title style="color: #0DAE4F;">R {{listing.price}}</ion-card-title>
                          </ion-col>
                          <ion-col>
                            <div class="statusBadge {{listing.status}}">{{listing.status}}</div>
                          </ion-col>
                        </ion-row>
                      </ion-grid>
                      <p><b>{{listing.address}}</b></p>
                      <p style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap">
                        {{listing.bed}} Bedroom {{listing.prop_type === "Commercial"? listing.prop_type + " Property" : listing.prop_type}}
                      </p>
                      <p>To Let!</p>
                      <p id="house_description">
                      {{listing.desc}}
                      </p>
                      <div id="house_details">
                        <img src="assets/icon/bedrooms.png">
                        {{listing.bed}}
                        &nbsp; &nbsp;&nbsp;
                        <img src="assets/icon/bathrooms.png">
                        {{listing.bath}}
                        &nbsp; &nbsp;&nbsp;
                        <img src="assets/icon/floorplan.png">
                        {{listing.floor_size}} m<sup>2</sup>
                        &nbsp; &nbsp;&nbsp;
                        <img src="assets/icon/erf.png">
                        {{listing.property_size}} m<sup>2</sup>
                      </div>
                    </ion-col>
                  </ion-row>
                </ion-grid>
            </ion-card>
            <ng-container *ngIf="!savedListingsR.length">
              <div style="width: 100%; display: flex; justify-content: center;">
                <ion-icon name="home-outline"></ion-icon>
                <div>No saved listings to show</div>
              </div>
            </ng-container>
          </ion-col>
        </ion-row>
      </ion-grid>
    </section>
  
    <section id="second">
    <ion-grid>
      <ion-row>
        <ion-col size="6" class="rightBorder">
          <ion-card class="listingCard" *ngFor="let listing of savedListingsB">
            <ion-grid>
              <ion-row>
                <ion-col size="4" class="imageCol">
                  <img src="{{listing.photos[0]}}" onerror="this.src='assets/no-propertyfound.png'" alt="house1">
                </ion-col>
                <ion-col size="8">
                  <ion-grid style="z-index:1;"  (click)="redirectToPage(listing)">
                    <ion-row>
                      <ion-grid>
                        <ion-row>
                          <ion-col>
                            <ion-card-title style="color: #0DAE4F;">Area Ratings</ion-card-title>
                          </ion-col>
                          <ion-col>
                            <div class="statusBadge {{listing.status}}">{{listing.status}}</div>
                          </ion-col>
                        </ion-row>
                      </ion-grid>
                    </ion-row>
                    <ion-row>
                      <ion-col>
                        <div class="white-text">Water</div>
                          <div class="slider">
                            <div 
                              [class.progress]="listing.areaScore.waterScore >= 60" 
                              [class.errorProgressBar]="listing.areaScore.waterScore < 25" 
                              [class.warningProgressBar]="listing.areaScore.waterScore < 60 && listing.areaScore.waterScore >= 25" 
                              [style.width]="listing.areaScore.waterScore+'%'"
                            ></div>
                          </div>
                      </ion-col>
                      <ion-col>
                      <div class="white-text">Sanitation</div>
                      <div class="slider">
                        <div 
                          [class.progress]="listing.areaScore.sanitationScore >= 60" 
                          [class.errorProgressBar]="listing.areaScore.sanitationScore < 25" 
                          [class.warningProgressBar]="listing.areaScore.sanitationScore < 60 && listing.areaScore.sanitationScore >= 25" 
                          [style.width]="listing.areaScore.sanitationScore+'%'"
                        ></div>
                      </div>
                      </ion-col>
                    </ion-row>
      
                    <ion-row style="margin-top: 2px;">
                      <ion-col>
                      <div class="white-text">Crime</div>
                      <div class="slider">
                        <div 
                          [class.progress]="listing.areaScore.crimeScore >= 60" 
                          [class.errorProgressBar]="listing.areaScore.crimeScore < 25" 
                          [class.warningProgressBar]="listing.areaScore.crimeScore < 60 && listing.areaScore.crimeScore >= 25" 
                          [style.width]="listing.areaScore.crimeScore+'%'"
                        ></div>
                      </div>
                      </ion-col>
                      <ion-col>
                      <div class="white-text">School Quality</div>
                      <div class="slider">
                        <div 
                          [class.progress]="listing.areaScore.schoolScore >= 60"  
                          [class.errorProgressBar]="listing.areaScore.schoolScore < 25"  
                          [class.warningProgressBar]="listing.areaScore.schoolScore < 60 && listing.areaScore.schoolScore >= 25" 
                          [style.width]="listing.areaScore.schoolScore+'%'"
                        ></div>
                      </div>    
                      </ion-col>
                    </ion-row>
                    <span style="float: right;"><u>Total Score:</u> {{((listing.areaScore.schoolScore + listing.areaScore.crimeScore + listing.areaScore.waterScore + listing.areaScore.sanitationScore)/4).toFixed(2)}} </span>              
                  </ion-grid>
                </ion-col>
              </ion-row>
            </ion-grid> 
          </ion-card>
          <ng-container *ngIf="!savedListingsB.length">
            <div style="width: 100%; display: flex; justify-content: center;">
              <ion-icon name="home-outline"></ion-icon>
              <div>No saved listings to show</div>
            </div>
          </ng-container>
        </ion-col>
        <ion-col size="6">
          <ion-card class="listingCard" *ngFor="let listing of savedListingsR">
            <ion-grid>
              <ion-row>
                <ion-col  size="4" class="imageCol">
                  <img src="{{listing.photos[0]}}" onerror="this.src='assets/no-propertyfound.png'" alt="house1">
                </ion-col>
                <ion-col size="8">
                  <ion-grid style="z-index:1;"  (click)="redirectToPage(listing)">
                    <ion-row>
                      <ion-grid>
                        <ion-row>
                          <ion-col>
                            <ion-card-title style="color: #0DAE4F;">Area Ratings</ion-card-title>
                          </ion-col>
                          <ion-col>
                            <div class="statusBadge {{listing.status}}">{{listing.status}}</div>
                          </ion-col>
                        </ion-row>
                      </ion-grid>
                    </ion-row>
                    <ion-row>
                      <ion-col>
                        <div class="white-text">Water</div>
                          <div class="slider">
                            <div 
                              [class.progress]="listing.areaScore.waterScore >= 60" 
                              [class.errorProgressBar]="listing.areaScore.waterScore < 25" 
                              [class.warningProgressBar]="listing.areaScore.waterScore < 60 && listing.areaScore.waterScore >= 25" 
                              [style.width]="listing.areaScore.waterScore+'%'"
                            ></div>
                          </div>
                      </ion-col>
                      <ion-col>
                      <div class="white-text">Sanitation</div>
                      <div class="slider">
                        <div 
                          [class.progress]="listing.areaScore.sanitationScore >= 60" 
                          [class.errorProgressBar]="listing.areaScore.sanitationScore < 25" 
                          [class.warningProgressBar]="listing.areaScore.sanitationScore < 60 && listing.areaScore.sanitationScore >= 25" 
                          [style.width]="listing.areaScore.sanitationScore+'%'"
                        ></div>
                      </div>
                      </ion-col>
                    </ion-row>
      
                    <ion-row style="margin-top: 2px;">
                      <ion-col>
                      <div class="white-text">Crime</div>
                      <div class="slider">
                        <div 
                          [class.progress]="listing.areaScore.crimeScore >= 60" 
                          [class.errorProgressBar]="listing.areaScore.crimeScore < 25" 
                          [class.warningProgressBar]="listing.areaScore.crimeScore < 60 && listing.areaScore.crimeScore >= 25" 
                          [style.width]="listing.areaScore.crimeScore+'%'"
                        ></div>
                      </div>
                      </ion-col>
                      <ion-col>
                      <div class="white-text">School Quality</div>
                      <div class="slider">
                        <div 
                          [class.progress]="listing.areaScore.schoolScore >= 60"  
                          [class.errorProgressBar]="listing.areaScore.schoolScore < 25"  
                          [class.warningProgressBar]="listing.areaScore.schoolScore < 60 && listing.areaScore.schoolScore >= 25" 
                          [style.width]="listing.areaScore.schoolScore+'%'"
                        ></div>
                      </div>    
                      </ion-col>
                    </ion-row>
                    <span style="float: right;"><u>Total Score:</u> {{((listing.areaScore.schoolScore + listing.areaScore.crimeScore + listing.areaScore.waterScore + listing.areaScore.sanitationScore)/4).toFixed(2)}} </span>              
                  </ion-grid>
                </ion-col>
              </ion-row>
            </ion-grid> 
          </ion-card>
          <ng-container *ngIf="!savedListingsR.length">
            <div style="width: 100%; display: flex; justify-content: center;">
              <ion-icon name="home-outline"></ion-icon>
              <div>No saved listings to show</div>
            </div>
          </ng-container>
        </ion-col>
      </ion-row>
    </ion-grid>
  </section>
  
    <ion-button id="saved" routerLink="/my-listings" routerDirection="root">
      <ion-icon name="home-outline" size="large" color="primary"></ion-icon>
      <ion-label>My Listings</ion-label>
      <ion-icon name="chevron-forward-outline" size="large" color="primary"></ion-icon>
    </ion-button>
  
    <ion-button id="swap" (click)="Change()">
      <ion-icon name="swap-horizontal-outline"></ion-icon>
    </ion-button>
  </ng-template>
</ion-content>
